generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Participante {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  even3Id      Int      @unique
  nome         String
  email        String   @unique
  foto         String?
  senha        String?
  documento    String?
  confirmado   Boolean  @default(false)
  
  presencas    Presenca[]?
  feedbacks    Feedback[]?
  
  @@map("participantes")
}

model Palestra {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  even3Id      Int      @unique
  titulo       String
  descricao    String?
  tipo         String
  local        String?
  
  horarios     Json
  palestrantes Json
  
  presencas    Presenca[]?
  feedbacks    Feedback[]?
  
  @@map("palestras")
}

model Presenca {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  participanteId String   @db.ObjectId
  palestraId     String   @db.ObjectId
  dataHora       DateTime @default(now())
  sincronizado   Boolean  @default(false)
  
  // RELAÇÕES OPCIONAIS (não quebram código do QR Code)
  participante Participante? @relation(fields: [participanteId], references: [id], onDelete: Cascade)
  palestra     Palestra?     @relation(fields: [palestraId], references: [id], onDelete: Cascade)
  
  @@map("presencas")
  @@unique([participanteId, palestraId])
}

model Feedback {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  participanteId String   @db.ObjectId
  palestraId     String   @db.ObjectId
  estrelas       Int
  comentario     String?
  data           DateTime @default(now())

  participante Participante @relation(fields: [participanteId], references: [id], onDelete: Cascade)
  palestra     Palestra     @relation(fields: [palestraId], references: [id], onDelete: Cascade)
  
  @@map("feedbacks")
  @@unique([participanteId, palestraId])
}