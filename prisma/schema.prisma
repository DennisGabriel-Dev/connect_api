generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Participante {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  even3Id      Int      @unique
  nome         String
  email        String   @unique
  foto         String?
  senha        String?
  documento    String?
  confirmado   Boolean  @default(false)
  
  presencas    Presenca[]
  feedbacks    Feedback[]
  
  @@map("participantes")
}

model Palestra {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  even3Id      Int      @unique
  titulo       String
  descricao    String?
  tipo         String
  local        String?
  
  horarios     Json
  palestrantes Json
  
  presencas    Presenca[]
  feedbacks    Feedback[]
  
  @@map("palestras")
}

model Presenca {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  participanteId String   @db.ObjectId
  palestraId     String   @db.ObjectId
  dataHora       DateTime @default(now())
  sincronizado   Boolean  @default(false)
  
  // RELAÇÕES OPCIONAIS (não quebram código do QR Code)
  participante Participante? @relation(fields: [participanteId], references: [id], onDelete: Cascade)
  palestra     Palestra?     @relation(fields: [palestraId], references: [id], onDelete: Cascade)
  
  @@map("presencas")
  @@unique([participanteId, palestraId])
}

model Feedback {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  participanteId String   @db.ObjectId
  palestraId     String   @db.ObjectId
  estrelas       Int
  comentario     String?
  data           DateTime @default(now())

  participante Participante @relation(fields: [participanteId], references: [id], onDelete: Cascade)
  palestra     Palestra     @relation(fields: [palestraId], references: [id], onDelete: Cascade)
  
  @@map("feedbacks")
  @@unique([participanteId, palestraId])
}

// Modelo para perguntas e respostas nas palestras
model Pergunta {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  texto             String   // Texto da pergunta
  participanteId    String   @db.ObjectId // ID do participante que fez a pergunta
  participanteNome  String   // Nome do participante (para exibição)
  palestraId        String   @db.ObjectId // ID da palestra
  palestraTitulo    String   // Título da palestra (para exibição)
  dataHora          DateTime @default(now()) // Quando foi feita a pergunta
  respondida        Boolean  @default(false) // Se já foi respondida
  resposta          String?  // Texto da resposta (opcional)
  palestranteNome   String?  // Nome do palestrante que respondeu
  dataResposta      DateTime? // Quando foi respondida
  curtidas          Int      @default(0) // Número de curtidas na pergunta
  
  @@map("perguntas")
  @@index([palestraId]) // Índice para buscar perguntas por palestra
}