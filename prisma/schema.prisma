generator client {
  provider = "prisma-client-js"
}

//NÃO TIREM OS COMETÁRIOS ELES DOCUMENTAM AS ALTERAÇÕES E FUNCIONALIDADES IMPORTANTES 

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Participante {
  id           String @id @default(auto()) @map("_id") @db.ObjectId
  even3Id      Int    @unique
  nome         String
  email        String @unique
  senha        String? 
  
  // CORREÇÃO AQUI: 
  presencas    Presenca[]
  feedbacks    Feedback[]
  
  @@map("participantes")
}

model Palestra {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  even3Id     Int      @unique
  titulo      String
  descricao   String?
  tipo        String
  local       String?
  
  horarios    HorarioEmbed[]
  palestrantes PalestranteEmbed[]
  
  // CORREÇÃO AQUI: Sem '?'
  presencas    Presenca[]
  feedbacks    Feedback[]
  
  @@map("palestras")
}

type HorarioEmbed {
  id_time    Int?
  date_start String? 
  date_end   String?
}

type PalestranteEmbed {
  even3Id   Int
  nome      String
  bio       String?
}

model Presenca {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  
  participanteId  String   @db.ObjectId
  participante    Participante @relation(fields: [participanteId], references: [id])
  
  palestraId      String   @db.ObjectId
  palestra        Palestra @relation(fields: [palestraId], references: [id])
  
  dataHora        DateTime @default(now())
  sincronizado    Boolean  @default(false)
  
  @@map("presencas")
  @@unique([participanteId, palestraId])
}

model Feedback {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  comentario      String
  nota            Int
  
  participanteId  String   @db.ObjectId
  participante    Participante @relation(fields: [participanteId], references: [id])
  
  palestraId      String   @db.ObjectId
  palestra        Palestra @relation(fields: [palestraId], references: [id])

  @@map("feedbacks")
}


model Quiz {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  titulo    String
  descricao String?
  liberado  Boolean @default(false)


  perguntas PerguntaEmbed[]
  tentativas Tentativa[]

  @@map("quizzes")
}

// Embedded types para perguntas e opcoes dentro do Quiz
type PerguntaEmbed {
  id     String
  texto  String
  pontos Int @default(10)
  opcoes OpcaoEmbed[]
}

type OpcaoEmbed {
  id       String
  texto    String
  eCorreta Boolean @default(false)
}

model Pontuacao {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  participanteId String   @db.ObjectId
  quizId         String?  @db.ObjectId
  pontos         Int

  @@map("pontuacoes")
  @@index([participanteId])
}

model Tentativa {
  id String   @id @default(auto()) @map("_id") @db.ObjectId
  pontosObtidos Int
  enviadoEm     DateTime @default(now())

  participanteId String   @db.ObjectId

  quizId    String   @db.ObjectId
  quiz      Quiz     @relation(fields: [quizId], references: [id])

  @@map("tentativas")
  @@unique([participanteId, quizId])
}

model Pergunta {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  texto             String   // Texto da pergunta
  participanteId    String   @db.ObjectId // ID do participante que fez a pergunta
  participanteNome  String   // Nome do participante (para exibição)
  palestraId        String   @db.ObjectId // ID da palestra
  palestraTitulo    String   // Título da palestra (para exibição)
  dataHora          DateTime @default(now()) // Quando foi feita a pergunta
  respondida        Boolean  @default(false) // Se já foi respondida
  resposta          String?  // Texto da resposta (opcional)
  palestranteNome   String?  // Nome do palestrante que respondeu
  dataResposta      DateTime? // Quando foi respondida
  curtidas          Int      @default(0) // Número de curtidas na pergunta
  
  @@map("perguntas")
  @@index([palestraId]) // Índice para buscar perguntas por palestra
}